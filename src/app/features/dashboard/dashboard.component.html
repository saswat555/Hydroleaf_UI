<div class="dashboard-container">
    <h1>Device Dashboard</h1>
    
    
    <!-- Show spinner while data is loading -->
    <div *ngIf="loading">
      <mat-spinner></mat-spinner>
    </div>
    
    <!-- Show table only when loading is done and there are devices -->
    <table mat-table [dataSource]="devices" class="mat-elevation-z8" *ngIf="!loading && devices && devices.length">
      
      <!-- Device ID Column -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let device"> {{ device.id }} </td>
      </ng-container>
      
      <!-- Device Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Name </th>
        <td mat-cell *matCellDef="let device"> {{ device.name }} </td>
      </ng-container>
      
      <ng-container matColumnDef="mqtt_topic">
        <th mat-header-cell *matHeaderCellDef> Http endpoint </th>
        <td mat-cell *matCellDef="let device"> {{ device.http_endpoint }} </td>
      </ng-container>
      
      <!-- Pump Configurations Column -->
      <ng-container matColumnDef="pump_configurations">
        <th mat-header-cell *matHeaderCellDef> Pump Configurations </th>
        <td mat-cell *matCellDef="let device">
          <div *ngIf="device.pump_configurations; else noPump">
            <div *ngFor="let pump of device.pump_configurations">
              <strong>Pump {{ pump.pump_number }}:</strong>
              {{ pump.chemical_name }}
              <span *ngIf="pump.chemical_description">
                ({{ pump.chemical_description }})
              </span>
            </div>
          </div>
          <ng-template #noPump>No pump data</ng-template>
        </td>
      </ng-container>
      
      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Actions </th>
        <td mat-cell *matCellDef="let device">
          <button mat-button color="primary" (click)="viewDevice(device.id)">View</button>
        </td>
      </ng-container>
      
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    
    <!-- Show "No devices" message if not loading and no devices exist -->
    <div *ngIf="!loading && (!devices || devices.length === 0)">
      <p>No devices added yet.</p>
    </div>
  </div>
  